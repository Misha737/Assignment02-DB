# Query optimization changing. Steps 1 and 2

## Step 1
В оригінальному запиті були вкладені запити, які виконувалися для кожнго рядка, що є дуже повільно. Для кращої читабильності та ефективності ці підзапити можна винисти в CTE та приєднати за допомогою **JOIN**.

Для ```AvgOpponentEloInSameOpening``` я використав віконну функцію **AVG ... OVER ...**

Відповідь на оригінальний запит я так і недочекався, коли він вже тривав 30хв. 
Без індексів, запит виконується за 40 секунд.

## Step 2

Для кращого пошуку рядків я створив 2 індекси для колонок:
1. ```WhiteElo```, ```result```, ```White```
2. ```White```
3. ```ECO```

 Із всіма змінами, запит відбуваєтьтся за **20 секунд**. Тобто CTE із більше ніж 30 хвилин запиту, оптимізував до 40 секунд, а додавання індексів покращило запит на 20 секунд.